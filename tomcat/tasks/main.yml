---
# tasks file for tomcat
- name: Ensure tomcat started
  service:
    name: tomcat9
    state: started

- name: Set list of files
  find:
    path: "{{ tomcatappdir }}"
    file_type: file
    patterns: '*.war'
    recurse: no #looking for wars in project folders
  register: war_files #list of paths to wars

- name: Remove war if exists
  file:
    path: "{{ item.path }}"
    state: absent
  with_items:
    - "{{ war_files.files }}"

- name: Transfer war to tomcat
  synchronize:
   mode: push
   src: "{{ tomcatappdir }}"
   dest: "{{ baseworkdir }}{{ appdir }}/{{ item.name }}"
  with_items: "{{ war_files.files }}"
  delegate_to: "{{ smaven }}"

- debug:
  var: "{{ war_files.files }}"

- name: check app installed
  stat:
   path: "{{ tomcatappdir }}{{ appdir }}"
  notify:
  - restart_tomcat

