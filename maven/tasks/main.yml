---
# tasks file for maven

- name: Ensure jdk package presents
  apt:
   name: default-jdk
   state: present

- name: Ensure git package presents
  apt:
   name: git
   state: present

- name: Ensure maven package presents
  apt:
   name: maven
   state: present

- name: Remove dir if exists
  file:
   path: "{{ baseworkdir }}{{ appdir }}"
   state: absent

- name: Add environments and pull code
  git:
   repo: '{{ url4git }}'
   dest: "{{ baseworkdir }}{{ appdir }}"
   clone: yes
   update: yes

- name: build code
  command: 'mvn -f {{ baseworkdir }}{{ appdir }}/pom.xml package'

- name: Set list of files
  find:
   path: "{{ baseworkdir }}{{ appdir }}"
   file_type: file
   patterns: '*.war'
   recurse: yes #looking for wars in project folders
  register: war_files #list of paths to wars

- name: Transfer war to tomcat
  synchronize:
   src: "{{ item.path }}"
   dest: "{{ tomcatappdir }}"
  with_items: "{{ war_files.files }}"
  delegate_to: "{{ stomcat }}"
